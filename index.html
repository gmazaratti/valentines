import React, { useState, useEffect, useRef } from 'react';

// --- SVGs ---

const OrganicHeart = ({ style, className, fill = "currentColor" }) => (
  <svg 
    viewBox="0 0 512 512" 
    width="100" 
    height="100" 
    className={className} 
    style={style}
  >
    <path 
      fill={fill} 
      d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"
    />
  </svg>
);

const LockIcon = ({ className }) => (
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
  </svg>
);

// --- Components ---

const MagicText = ({ text, className, delayStart = 0 }) => {
  return (
    <div className={`${className} relative cursor-default select-none`}>
      <div className="text-white drop-shadow-lg">
        {text.split('').map((char, i) => (
          <span
            key={i}
            className="inline-block transition-all duration-300 hover:scale-125 hover:-translate-y-2 hover:rotate-6 hover:text-rose-100"
            style={{
              animation: `float-subtle ${3 + Math.random()}s ease-in-out infinite`,
              animationDelay: `${delayStart + (Math.random() * 2)}s`,
            }}
          >
            {char === ' ' ? '\u00A0' : char}
          </span>
        ))}
      </div>
    </div>
  );
};

// --- Unwrap Gift Game Component ---

const UnwrapGiftGame = ({ onComplete }) => {
  const [clicks, setClicks] = useState(0);
  const [isShaking, setIsShaking] = useState(false);
  const targetClicks = 15;

  const handleClick = () => {
    if (clicks >= targetClicks) return;
    
    // Trigger shake animation
    setIsShaking(true);
    setTimeout(() => setIsShaking(false), 200);

    setClicks(prev => prev + 1);

    if (clicks + 1 >= targetClicks) {
      setTimeout(onComplete, 800);
    }
  };

  const progress = Math.min((clicks / targetClicks) * 100, 100);

  return (
    <div className="absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/40 backdrop-blur-md animate-fadeIn p-4">
      <div className="relative flex flex-col items-center">
        <h2 className="text-3xl font-black text-white text-center mb-8 drop-shadow-lg animate-bounce">
          Tap to Unwrap!
        </h2>
        
        <button 
          onClick={handleClick}
          className={`
            text-[150px] leading-none transition-all duration-100 cursor-pointer select-none filter drop-shadow-2xl
            ${isShaking ? 'animate-shake scale-110' : 'scale-100 hover:scale-105'}
            ${clicks >= targetClicks ? 'opacity-0 scale-150 duration-500' : 'opacity-100'}
          `}
          style={{ 
             transformOrigin: 'center bottom',
             textShadow: '0 10px 20px rgba(0,0,0,0.3)'
          }}
        >
          üéÅ
        </button>

        {/* Progress Bar */}
        <div className="mt-12 w-64 h-6 bg-white/20 rounded-full overflow-hidden border border-white/30 backdrop-blur-sm shadow-inner">
          <div 
            className="h-full bg-gradient-to-r from-rose-400 to-pink-500 transition-all duration-200 ease-out relative"
            style={{ width: `${progress}%` }}
          >
             <div className="absolute inset-0 bg-white/30 w-full h-full animate-shimmer-fast" />
          </div>
        </div>
        
        <p className="text-white/70 mt-3 font-bold text-sm">
          {Math.max(0, targetClicks - clicks)} taps left
        </p>
      </div>
    </div>
  );
};

// --- Phases ---
const PHASE = {
  INTRO: 'intro',
  GAME: 'game',
  ASK: 'ask',
  SUCCESS: 'success'
};

const App = () => {
  const [phase, setPhase] = useState(PHASE.INTRO);
  const [noCount, setNoCount] = useState(0);
  const [yesScale, setYesScale] = useState(1);
  const [showConfetti, setShowConfetti] = useState(false);
  const [currentReason, setCurrentReason] = useState(null);

  // --- CUSTOMIZE THESE REASONS FOR YOUR GIRLFRIEND ---
  const loveReasons = [
    "cooking with you",
    "How you fall asleep on me so peacefully",
    "How you always think my food is better",
    "Your obsession with teen wolf",
    "How excited you get about the smallest things",
    "That you say you hate when I annoy you but then miss it",
    "The way you look at me when you think I'm not looking",
    "Our long facetime calls",
    "Your creativity and how smart you are",
    "Keep it one hundred on the land, the sea, the sky",
    "That you put up with my procrastination",
    "How you make doing absolutely nothing fun",
    "Your smile is literally my favorite thing to look at",
    "that i love you.",
    "because you're you"
  ];

  const handleNextReason = () => {
    let nextIdx;
    do {
      nextIdx = Math.floor(Math.random() * loveReasons.length);
    } while (loveReasons[nextIdx] === currentReason && loveReasons.length > 1);
    
    setCurrentReason(loveReasons[nextIdx]);
  };

  const noPhrases = [
    "No", "Are you sure?", "Really sure?", "Think again!", "Last chance!", 
    "Surely not?", "You might regret this!", "Give it another thought!", 
    "Are you absolutely certain?", "This could be a mistake!", "Have a heart!", 
    "Don't be so cold!", "Change of heart?", "Wouldn't you reconsider?", 
    "Is that your final answer?", "You're breaking my heart ;(", "Plsss?"
  ];

  const handleNoClick = () => {
    setNoCount(noCount + 1);
    setYesScale(prev => Math.min(prev + 0.4, 15));
  };

  return (
    <div className="min-h-screen bg-gradient-mesh font-sans text-white relative overflow-hidden flex flex-col items-center justify-center p-6 selection:bg-rose-500 selection:text-white">
      
      {/* Background Elements */}
      <div className="fixed inset-0 pointer-events-none overflow-hidden z-0">
         {[...Array(15)].map((_, i) => (
            <div
              key={i}
              className="absolute text-white blur-[2px] animate-float-slow mix-blend-overlay opacity-30"
              style={{
                left: `${Math.random() * 100}%`,
                bottom: '-20%',
                width: `${20 + Math.random() * 40}px`,
                height: `${20 + Math.random() * 40}px`,
                animation: `float ${10 + Math.random() * 20}s linear infinite`,
                animationDelay: `${Math.random() * -20}s`,
                transform: `rotate(${Math.random() * 360}deg)`
              }}
            >
              <OrganicHeart className="w-full h-full" />
            </div>
         ))}
      </div>
      
      {/* PHASE 1: INTRO */}
      <div className={`relative z-10 w-full max-w-lg text-center transition-all duration-700 ease-in-out ${phase === PHASE.INTRO ? 'opacity-100 translate-y-0' : 'hidden opacity-0 translate-y-[-20px]'}`}>
        {phase === PHASE.INTRO && (
          <div className="flex flex-col items-center space-y-8 animate-fadeIn">
            <div className="relative group cursor-pointer">
               <div className="absolute inset-0 bg-white/30 rounded-full blur-2xl animate-pulse"></div>
               <div className="text-8xl drop-shadow-2xl animate-bounce-custom relative z-10 transition-transform group-hover:scale-110 duration-300">
                 üíå
               </div>
            </div>
            
            <div className="space-y-4">
              <MagicText text="I didn't forget!" className="text-5xl font-black tracking-tight leading-tight" />
              <p className="text-xl font-medium text-white/90 drop-shadow-md max-w-sm mx-auto leading-relaxed opacity-0 animate-slideUp delay-200">
                I actually sent you a letter a while ago, but the mailman is apparently walking to your house...
              </p>
            </div>

            <button
              onClick={() => setPhase(PHASE.GAME)}
              className="group relative mt-8 px-10 py-5 bg-white/10 backdrop-blur-md text-white rounded-full font-bold text-xl shadow-[0_0_40px_-5px_rgba(255,255,255,0.2)] hover:bg-white hover:text-rose-500 hover:shadow-[0_0_60px_-5px_rgba(255,255,255,0.6)] hover:scale-105 active:scale-95 transition-all duration-300 flex items-center gap-3 border-2 border-white/50"
            >
              <LockIcon className="w-5 h-5" />
              <span>Unlock Digital Letter</span>
            </button>
            <p className="text-sm text-white/60 font-medium">(Requires Unlocking)</p>
          </div>
        )}
      </div>

      {/* PHASE 2: UNWRAP GAME */}
      {phase === PHASE.GAME && (
        <UnwrapGiftGame onComplete={() => setPhase(PHASE.ASK)} />
      )}

      {/* PHASE 3: ASK */}
      <div className={`relative z-10 w-full max-w-lg text-center transition-all duration-700 ease-in-out ${phase === PHASE.ASK ? 'opacity-100 translate-y-0' : 'hidden opacity-0 translate-y-20'}`}>
         {phase === PHASE.ASK && (
          <div className="flex flex-col items-center animate-fadeIn">
             <div className="relative mb-8 group">
               <div className="absolute inset-0 bg-white/30 rounded-full blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>
               <img 
                src="https://media1.tenor.com/m/Al01J0E9h6IAAAAC/milk-and-mocha-bear-couple.gif" 
                alt="Cute bear" 
                className="h-48 rounded-2xl drop-shadow-2xl relative z-10 transform hover:scale-105 transition-transform duration-500"
                onError={(e) => { e.target.onerror = null; e.target.src = "https://media.giphy.com/media/26BRv0ThflsHCqDrG/giphy.gif" }}
               />
               <span className={`absolute -right-6 -top-6 text-7xl drop-shadow-xl ${yesScale > 1 ? 'hidden' : 'block animate-wiggle'}`}>üåπ</span>
            </div>

            {/* Separated Text for Better Layout */}
            <div className="flex flex-col items-center mb-8">
              <MagicText 
                text="Will you be my" 
                className="text-4xl md:text-5xl font-black drop-shadow-lg tracking-tight" 
              />
              <MagicText 
                text="Valentine?" 
                className="text-6xl md:text-7xl font-black drop-shadow-lg tracking-tight mt-3 text-rose-200" 
              />
            </div>

            <div className="flex flex-col items-center gap-6 w-full">
              <button
                onClick={() => { setPhase(PHASE.SUCCESS); setShowConfetti(true); setCurrentReason(loveReasons[0]); }}
                style={{ transform: `scale(${yesScale})`, transformOrigin: 'center bottom' }}
                className="group relative px-12 py-5 bg-gradient-to-r from-white via-rose-50 to-white text-rose-600 rounded-full font-black text-2xl shadow-[0_0_50px_-10px_rgba(255,255,255,0.6)] hover:shadow-[0_0_80px_-5px_rgba(255,255,255,0.8)] transition-all duration-300 z-20 min-w-[200px] tracking-wide overflow-hidden border-2 border-white/50"
              >
                <div className="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-rose-200/50 to-transparent -translate-x-full animate-shimmer-fast" />
                <span className="relative z-10 group-hover:scale-105 inline-block transition-transform">YES! ‚ù§Ô∏è</span>
              </button>

              <button
                onClick={handleNoClick}
                className="px-8 py-4 bg-transparent border-2 border-white/30 text-white/70 rounded-full font-bold text-sm hover:bg-white/10 hover:text-white hover:border-white transition-all z-10 backdrop-blur-sm"
              >
                {noPhrases[Math.min(noCount, noPhrases.length - 1)]}
              </button>
            </div>
          </div>
        )}
      </div>

      {/* PHASE 4: SUCCESS */}
      <div className={`relative z-10 w-full max-w-lg text-center transition-all duration-700 ease-in-out ${phase === PHASE.SUCCESS ? 'opacity-100 scale-100' : 'hidden opacity-0 scale-90'}`}>
        {phase === PHASE.SUCCESS && (
          <div className="flex flex-col items-center animate-fadeInUp space-y-8 w-full">
            <div className="text-8xl drop-shadow-2xl animate-heartbeat">üíñ</div>
            
            <div className="flex flex-col items-center">
              <MagicText text="Good choice!" className="text-5xl md:text-6xl font-black drop-shadow-lg leading-tight" />
              <span className="block text-2xl md:text-3xl mt-4 opacity-80 font-bold animate-pulse">(There wasn't any other)</span>
            </div>
            
            <div className="space-y-4 bg-white/10 backdrop-blur-md p-6 rounded-3xl border border-white/20 shadow-xl w-full">
               <p className="text-xl font-bold text-white drop-shadow-md">It's a date!</p>
               <p className="text-lg text-white/80 font-medium max-w-sm mx-auto">(Dinner is on the way to your door btw)</p>
            </div>

            {/* Replayability Feature: The Reason Generator */}
            <div className="w-full pt-4">
              <div className="bg-white text-rose-600 p-6 rounded-2xl shadow-2xl transform transition-all hover:scale-[1.02]">
                <p className="text-xs uppercase font-bold tracking-widest text-rose-300 mb-2">Reason I love you #{loveReasons.indexOf(currentReason) + 1}</p>
                <p className="text-xl font-bold leading-relaxed">"{currentReason}"</p>
              </div>
              
              <button 
                onClick={handleNextReason}
                className="mt-6 text-white font-bold bg-white/20 hover:bg-white/30 px-6 py-3 rounded-full transition-all flex items-center gap-2 mx-auto border border-white/30"
              >
                <span>Tell me another reason</span>
                <span className="animate-spin-slow text-xl">‚Üª</span>
              </button>
            </div>
            
             <button 
                className="mt-8 text-white/40 font-semibold text-sm hover:text-white transition"
                onClick={() => window.location.reload()}
              >
                Start Over
              </button>
          </div>
        )}
      </div>

      {/* CSS Confetti */}
      {showConfetti && (
        <div className="fixed inset-0 pointer-events-none z-50 flex items-center justify-center overflow-hidden">
           {[...Array(50)].map((_, i) => (
             <div 
               key={i}
               className="absolute animate-confetti"
               style={{
                 left: '50%',
                 top: '50%',
                 backgroundColor: ['#fff', '#ffd1dc', '#ff69b4', '#fffacd'][Math.floor(Math.random() * 4)],
                 width: `${Math.random() * 12 + 8}px`,
                 height: `${Math.random() * 12 + 8}px`,
                 transform: `rotate(${Math.random() * 360}deg)`,
                 animationDelay: `${Math.random() * 0.2}s`,
                 animationDuration: `${1.5 + Math.random()}s`,
                 borderRadius: Math.random() > 0.5 ? '50%' : '4px',
                 boxShadow: '0 0 10px rgba(255,255,255,0.5)'
               }}
             />
           ))}
        </div>
      )}

      <style>{`
        .bg-gradient-mesh {
          background-color: #ff9a9e;
          background-image: 
            radial-gradient(at 10% 10%, hsla(339,100%,74%,1) 0px, transparent 50%),
            radial-gradient(at 90% 0%, hsla(280,100%,76%,1) 0px, transparent 50%),
            radial-gradient(at 10% 90%, hsla(242,100%,70%,1) 0px, transparent 50%),
            radial-gradient(at 90% 90%, hsla(333,100%,66%,1) 0px, transparent 50%),
            radial-gradient(at 50% 50%, hsla(350,100%,76%,1) 0px, transparent 50%);
          background-size: 150% 150%;
          animation: gradient-flow 10s ease infinite alternate;
        }

        @keyframes floatUp {
          from { bottom: -50px; opacity: 1; transform: scale(1); }
          to { bottom: 100%; opacity: 0; transform: scale(0.5) rotate(20deg); }
        }

        @keyframes float-subtle {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-8px); }
        }

        @keyframes gradient-flow {
          0% { background-position: 0% 50%; }
          100% { background-position: 100% 50%; }
        }

        @keyframes float {
          0% { transform: translateY(0) rotate(0deg); }
          100% { transform: translateY(-120vh) rotate(360deg); }
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
          from { opacity: 0; transform: scale(0.8) translateY(50px); }
          to { opacity: 1; transform: scale(1) translateY(0); }
        }

        @keyframes confetti {
            0% { transform: translate(0,0) rotate(0deg); opacity: 1; }
            100% { transform: translate(${Math.random() * 1000 - 500}px, ${Math.random() * 1000 - 500}px) rotate(720deg); opacity: 0; }
        }

        @keyframes heartbeat {
          0% { transform: scale(1); }
          15% { transform: scale(1.2); }
          30% { transform: scale(1); }
          45% { transform: scale(1.2); }
          100% { transform: scale(1); }
        }
        
        @keyframes wiggle {
           0%, 100% { transform: rotate(-3deg); }
           50% { transform: rotate(3deg); }
        }
        
        @keyframes bounce {
          0%, 100% { transform: translateY(-5%); }
          50% { transform: translateY(0); }
        }
        
        @keyframes shake {
          0%, 100% { transform: rotate(0deg); }
          25% { transform: rotate(-5deg); }
          75% { transform: rotate(5deg); }
        }
        
        .animate-shake {
          animation: shake 0.2s ease-in-out infinite;
        }

        @keyframes shimmer {
          100% { transform: translateX(100%); }
        }
        
        .animate-shimmer-fast {
          animation: shimmer 1s infinite;
        }

        .animate-slideUp {
          animation: slideUp 0.8s ease-out forwards;
        }
        
        .animate-bounce-custom {
           animation: bounce 2s infinite;
        }
        
        .animate-spin-slow {
          animation: spin 3s linear infinite;
        }
        
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        
        .delay-200 {
          animation-delay: 200ms;
        }

        @keyframes slideUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `}</style>
    </div>
  );
};

export default App;